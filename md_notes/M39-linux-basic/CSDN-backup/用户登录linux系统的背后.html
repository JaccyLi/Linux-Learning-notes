<center><font size="214" face="黑体" color="grey"> Linux用户登录流程介绍</font></center>
<blockquote>
<h2><a id="1Linux_2"></a>1.在Linux系统，用户登录流程是怎样的呢？</h2>
</blockquote>
<p>那我们就介绍常常被忽略的一些基本概念，很多人都知道linux的启动流程中init进程会负责启动linux，但是对于登录的基本过程却比较忽视。接下来就让大家熟悉熟悉当init进程完成执行/etc/rc.local文件并等到我们用户看到PS1所提供的交互界面（以便我们执行期望的命令）之后用户登录的过程是怎样的。</p>
<h3><a id="2_6"></a>2.一个大致的登陆过程如下：</h3>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-WYIB2P0JCxJSTOjh" height="577.53125" width="410.453125" viewBox="0 0 430.453125 597.53125"><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M205.2265625,67.921875L205.2265625,92.921875L205.2265625,117.921875" marker-end="url(#arrowhead120)" style="fill:none"></path><defs><marker id="arrowhead120" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M205.2265625,165.84375L205.2265625,190.84375L205.2265625,215.84375" marker-end="url(#arrowhead121)" style="fill:none"></path><defs><marker id="arrowhead121" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M205.2265625,263.765625L205.2265625,288.765625L205.2265625,313.765625" marker-end="url(#arrowhead122)" style="fill:none"></path><defs><marker id="arrowhead122" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M205.2265625,361.6875L205.2265625,386.6875L205.2265625,411.6875" marker-end="url(#arrowhead123)" style="fill:none"></path><defs><marker id="arrowhead123" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M205.2265625,459.609375L205.2265625,484.609375L205.2265625,509.609375" marker-end="url(#arrowhead124)" style="fill:none"></path><defs><marker id="arrowhead124" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node" id="A" transform="translate(205.2265625,43.9609375)" style="opacity: 1;"><rect rx="5" ry="5" x="-119.3515625" y="-23.9609375" width="238.703125" height="47.921875"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-109.3515625,-13.9609375)"><foreignObject width="218.7042236328125" height="27.9296875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">第一步:init进程创建getty进程</div></foreignObject></g></g></g><g class="node" id="B" transform="translate(205.2265625,141.8828125)" style="opacity: 1;"><rect rx="5" ry="5" x="-152.296875" y="-23.9609375" width="304.59375" height="47.921875"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-142.296875,-13.9609375)"><foreignObject width="284.600830078125" height="27.9296875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">第二步:getty进程初始化login登录命令</div></foreignObject></g></g></g><g class="node" id="C" transform="translate(205.2265625,239.8046875)" style="opacity: 1;"><rect rx="5" ry="5" x="-185.2265625" y="-23.9609375" width="370.453125" height="47.921875"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-175.2265625,-13.9609375)"><foreignObject width="350.4638671875" height="27.9296875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">第三步:login登录命令尝试检查用户的密码凭证</div></foreignObject></g></g></g><g class="node" id="D" transform="translate(205.2265625,337.7265625)" style="opacity: 1;"><rect rx="5" ry="5" x="-151.8203125" y="-23.9609375" width="303.640625" height="47.921875"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-141.8203125,-13.9609375)"><foreignObject width="283.64410400390625" height="27.9296875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">第四步:getty进程创建用户的shell进程</div></foreignObject></g></g></g><g class="node" id="E" transform="translate(205.2265625,435.6484375)" style="opacity: 1;"><rect rx="5" ry="5" x="-126.0390625" y="-23.9609375" width="252.078125" height="47.921875"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-116.0390625,-13.9609375)"><foreignObject width="232.08160400390625" height="27.9296875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">第五步:getty读取shell属性文件</div></foreignObject></g></g></g><g class="node" id="F" transform="translate(205.2265625,533.5703125)" style="opacity: 1;"><rect rx="5" ry="5" x="-176.1640625" y="-23.9609375" width="352.328125" height="47.921875"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-166.1640625,-13.9609375)"><foreignObject width="332.33642578125" height="27.9296875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">第六步:getty向用户提供PS1提示符交互界面</div></foreignObject></g></g></g></g></g></g></svg></div>
<h3><a id="3_16"></a>3.我们通过将大概的登陆过程细化来一探究竟</h3>
<ul>
<li>
<p><strong>第0步</strong>：一旦init进程完成运行级别的执行和/etc/rc.local中的命令的执行，其将会启动一个名叫getty的进程。getty是负责整个登录过程的进程。</p>
</li>
<li>
<p><strong>第1步</strong>：getty初始化login命令并提供一个带‘login：’字样的字符登录界面，并等待用户输入用户名。一旦用户输入用户名，接着并会提示输入密码。用户输入的密码并不会显示在终端。</p>
</li>
<li>
<p><strong>第2步</strong>：接着getty进程会检查用户的密码凭证，如果密码与系统中记录的一致getty会初始化用户的属性收集进程，否则getty会结束login进程重新初始化一个新的login进程。这个过程在大多数linux/unix系统上会进行三次。如果用户连续输错三次其密码凭证，getty会使用PAM模块控制未授权的登录并禁用终端10s。</p>
</li>
<li>
<p><strong>第3步</strong>：用户凭证通过验证后，getty进程读取用户的一些属性如：用户名、UID、GUI、家目录、从/etc/passwd文件中读取的用户shell（其依赖于相应的系统变量如：<code>$USER,$UID,$GUI,$HOME,$SHELL</code>）等。</p>
</li>
<li>
<p><strong>第4步</strong>：当getty开启用户shell进程之前收集到所有属性后会读取/etc/mootd文件，并将其内容作展示到终端。</p>
</li>
<li>
<p><strong>第5步</strong>：现在getty进程会读取/etc/profile文件以正确的设置和shell相关的配置并使得我们所设置的命令别名或者一些变量生效。</p>
</li>
<li>
<p><strong>第6步</strong>：在读取/etc/profile文件后getty进程会读取用户的家目录的一些文件并根据’.bashrc’文件配置更改shell的属性和配置，如果默认shell为bash则会根据’.bash_prfile’来更改shell的相关属性。getty会从/etc/passwd文件中确定使用什么shell为用户的默认shell。</p>
</li>
<li>
<p><strong>第7步</strong>：getty接着启动一个软件，就是用来和用户直接交互的shell程序。getty从前面解析/etc/passwd文件所设置好的$SHELL环境变量中知道需要启动shell程序。现在终端就展示出PS1提示界面等待用户执行命令。</p>
</li>
<li>
<p><strong>以上的所有过程都是在内核的监控下完成的</strong></p>
</li>
</ul>

