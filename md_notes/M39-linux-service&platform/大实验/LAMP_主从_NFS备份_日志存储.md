# LAMP 综合实验

## 一.实验目标

实验目标如下：

## 二.实验准备

### 2.1 实验环境

实验使用虚拟机:
虚拟机版本: `VMware Workstation pro 15.0.0`
Linux 系统版本: `Centos7.7`

实验虚拟主机:六台
`172.20.1.225----172.20.1.230`

六台主机情况
![](png/2019-12-20-18-30-08.png)

### 2.2 整体架构

![](png/lamp_lab_architecture.png)

### 2.3 所使用软件包

软件包列表:
: `apr-1.7.0.tar.bz2` --- `172.20.1.225` 编译 httpd 需要的依赖包
: `apr-util-1.6.1.tar.bz2`--- `172.20.1.225` 编译 httpd 需要的依赖包
: `httpd-2.4.41.tar.gz`--- `172.20.1.225` web 服务器安装
: `php-7.3.10.tar.xz`--- `172.20.1.225` web 服务器安装
: `wordpress-5.3-zh_CN.tar.gz`--- `172.20.1.225` web 服务器安装
: `mariadb-10.2.29-linux-systemd-x86_64.tar.gz`--- `172.20.1.[226:227]`
web 服务器的数据存放主机和备份服务器安装
: `inotify-tools`--- `172.20.1.228` nfs 服务器安装，监控共享目录文件
变动，以便通知 rsync 将数据同步到备份服务器
: `rsync` --- `172.20.1.[228:229]` nfs 服务器和备份服务器都要安装
: `nfs-utils`--- `172.20.1.[228,225]` nfs 共享服务器需要安装，其带有
nfs 文件共享服务相关的工具
: `autofs`--- `172.20.1.225` apache 服务器用来自动挂载 nfs 文件系统

### 2.3 思路

- 大致思路是: `配置LAMP --> 完成数据库主从备份 --> 完成nfs共享文件夹挂载到web服务器 --> 完成日志转储到日志存储主机的数据库 --> 测试`

- 需要注意的是，每完成一步需要测试该步是否成功。

- 具体步骤

```ruby
实现LAMP，主从复制
1. 首先在 web 服务器172.20.1.225编译安装httpd和php
2. 配置httpd支持php，并开启opcache等功能
3. 在主数据库主机二进制安装MariaDB，开启二进制日志，创建wordpress的数据库和相应的用户
4. 在主数据库创建一个用于从数据库复制的用户
5. 在从数据库主机二进制安装MariaDB，使用CHANGE MASTER TO指令与主数据库同步
6. 测试数据库同步情况
7. 准备wordpress程序包，解压到web服务器的服务目录，更改web服务器配置并重启
8. 配置wordpress，使其能够连接数据库
9. 测试是否能够正常访问wordpress管理界面

实现nfs服务器的共享文件夹挂载到web服务器的wordpress图片目录下
10. 在nfs服务器安装nfs-utils，创建用于访问共享文件夹的用户和家目录
11. 编辑/etc/exports配置文件，执行exportfs -r将其家目录共享
12. 在web服务器安装nfs-utils，执行`showmount -e nfs服务器ip`查看nfs服务共享的文件夹
13. 在web服务器安装autofs，编辑/etc/auto.master指定自动挂载的方式，并编辑指定的配置文件
来自动挂载nfs共享的文件夹
14. 在nfs服务器和备份服务器安装rsync，在nfs服务器安装inotify-tools
15. 在备份服务器配置/etc/rsyncd.conf 使得rsync以独立服务方式运行，并创建
验证文件(保存的内容为"用户名:密码")
16. 在nfs服务器添加密码文件，同15步中备份服务器验证文件的密码
17. 在nfs服务器编写脚本，将共享文件夹备份到备份服务器

实现日志转存到专门的日志存储服务器，存储于该服务器的数据库中
18. 在日志存储服务器二进制安装MariaDB
19. 在其他主机安装rsyslog-mysql模块，rsyslog用来和mariadb交互的模块
安装rsyslog-mysql模块会自带一个sql语句文件
20. rpm -ql rsyslog-mysql-->复制生成rsyslog要用的表的sql语句到日志存储服务器
21. 应用sql语句生成存储日志的数据库和表，并创建一个用户来给其他主机连接和访问
存储日志的数据库和表
22. 重启相关服务并测试，在其他主机使用logger "logging test message" 测试，
在日志存储服务器查看是否有记录

最终测试
23. 在wordpress上传和下载文件，发布博文，再检查备份数据库的同步情况
nfs共享目录是否更新，日志是否都被存储到日志服务器。
```

## 三.实验步骤

## 四.测试

## 五.总结
